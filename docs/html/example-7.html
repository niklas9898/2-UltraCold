<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UltraCold: example-7</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">UltraCold
   </div>
   <div id="projectbrief">Collection of C++ libraries for the study of ultra-cold systems in the context of Gross-Pitaevskii theory</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('example-7.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">example-7 </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Title-7">Far from equilibrium dynamics in a 3D dipolar Bose gas, using GPU acceleration.</a><ul><li class="level2"><a href="#Introduction-7">Introduction</a></li>
<li class="level2"><a href="#What-7">Program description</a></li>
<li class="level2"><a href="#Results-7">Results</a></li>
<li class="level2"><a href="#Uncommented-7">The plain program</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Santo Maria Roccuzzo (<a href="#" onclick="location.href='mai'+'lto:'+'san'+'to'+'m.r'+'oc'+'cuz'+'zo'+'@gm'+'ai'+'l.c'+'om'; return false;">santo<span class="obfuscator">.nosp@m.</span>m.ro<span class="obfuscator">.nosp@m.</span>ccuzz<span class="obfuscator">.nosp@m.</span>o@gm<span class="obfuscator">.nosp@m.</span>ail.c<span class="obfuscator">.nosp@m.</span>om</a>)</dd></dl>
<h1><a class="anchor" id="Title-7"></a>
Far from equilibrium dynamics in a 3D dipolar Bose gas, using GPU acceleration.</h1>
<h2><a class="anchor" id="Introduction-7"></a>
Introduction</h2>
<p >We want to study the far from equilibrium behavior of a 3D dipolar Bose gas. We use the mean field Gross-Pitaevskii equation for a dipolar system for our model</p>
<p class="formulaDsp">
\[
\begin{equation}
    i\hbar\frac{\partial }{\partial t}\Psi({\bf r},t) =
     \left[-\frac{\hbar^2}{2m}\nabla^2+V_{\mathrm{ext}}({\bf r})+g|\Psi({\bf r},t)|^2+ \right.
     \left. \frac{\mu_0\mu^2}{4\pi} \int d{\bf r}&#39; U_{dd}({\bf r}-{\bf r}&#39;) |\Psi({\bf r}&#39;,t)|^2 \right] \Psi({\bf r},t)
\end{equation}
\]
</p>
<h2><a class="anchor" id="What-7"></a>
Program description</h2>
<p >The input file for this example will be called <code>example-7.prm</code> and contains the following text</p>
<pre class="fragment"># Mesh parameters

xmax = 120 # Size of the mesh along the x-axis, in micrometers. The mesh will extend from -xmax to xmax
ymax = 120 # Size of the mesh along the y-axis, in micrometers. The mesh will extend from -ymax to ymax
zmax = 120 # Size of the mesh along the y-axis, in micrometers. The mesh will extend from -ymax to ymax

nx = 512 # Number of points along the x-axis
ny = 512 # Number of points along the y-axis
nz = 512 # Number of points along the z-axis

# Physical parameters

scattering length   = 150.0  # Scattering length in units of the Bohr radius
dipolar    length   = 132.0  # Dipolar length in units of the Bohr radius
number of particles = 400000000  # Total number of atoms
atomic mass         = 164    # Atomic mass, in atomic mass units
theta = 0.0 # tilt angle in radiant

# Run parameters for gradient descent

number of gradient descent steps = 500 # maximum number of gradient descent steps
residual                         = 1.E-12 # Threshold on the norm of the residual
alpha                            = 1.E-4 # gradient descent step
beta                             = 0.9   # step for the heavy-ball acceleration method

# Run parameters for real-time dynamics

number of real time steps = 5000000 # Total number of time-steps for real time dynamics
time step                 = 0.001 # Time step for real-time dynamics, in milliseconds
write output every        = 1000   # Write output every tot iterations

kcut = 1</pre><p >At the beginning of the program, we define our solver class with customizable output</p>
<div class="fragment"><div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_dipoles3d.html">Dipoles3d</a> : <span class="keyword">public</span> cudaSolvers::DipolarGPSolver</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using </span>DipolarGPSolver::DipolarGPSolver;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="class_dipoles3d.html#a040907cd0636d851dea43d1b3441aa96">write_operator_splitting_output</a>(<span class="keywordtype">size_t</span> iteration_number,</div>
<div class="line">                                         std::ostream&amp; output_stream) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_healing_length(<span class="keywordtype">double</span> healing_length){ internal_healing_length = healing_length; };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> kc;</div>
<div class="line">    <span class="keywordtype">double</span> internal_healing_length;</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="class_dipoles3d.html#a040907cd0636d851dea43d1b3441aa96">Dipoles3d::write_operator_splitting_output</a>(<span class="keywordtype">size_t</span> iteration_number,</div>
<div class="line">                                                std::ostream &amp;output_stream)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a3829c8053041d1fb5e2aa9cc1d2da5a2">evaluate_integrated_occupation_number</a>();</div>
<div class="line">    std::ofstream momentum_cuts;</div>
<div class="line">    momentum_cuts.open(<span class="stringliteral">&quot;nkx&quot;</span>+std::to_string(iteration_number/write_output_every)+<span class="stringliteral">&quot;.txt&quot;</span>,std::ios::out);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> ix = 0; ix &lt; <a class="code hl_class" href="classint.html">int</a>(nx/2); ++ix)</div>
<div class="line">        momentum_cuts &lt;&lt; kx_axis(ix) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                      &lt;&lt; integrated_occupation_number[0](ix)/(npoints)</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">    momentum_cuts.close();</div>
<div class="line"> </div>
<div class="line">    momentum_cuts.open(<span class="stringliteral">&quot;nky&quot;</span>+std::to_string(iteration_number/write_output_every)+<span class="stringliteral">&quot;.txt&quot;</span>,std::ios::out);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> iy = 0; iy &lt; <a class="code hl_class" href="classint.html">int</a>(ny/2); ++iy)</div>
<div class="line">        momentum_cuts &lt;&lt; ky_axis(iy) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                      &lt;&lt; integrated_occupation_number[1](iy)/npoints</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">    momentum_cuts.close();</div>
<div class="line"> </div>
<div class="line">    momentum_cuts.open(<span class="stringliteral">&quot;nkz&quot;</span>+std::to_string(iteration_number/write_output_every)+<span class="stringliteral">&quot;.txt&quot;</span>,std::ios::out);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> iz = 0; iz &lt; <a class="code hl_class" href="classint.html">int</a>(nz/2); ++iz)</div>
<div class="line">        momentum_cuts &lt;&lt; kz_axis(iz) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                      &lt;&lt; integrated_occupation_number[2](iz)/npoints</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">    momentum_cuts.close();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a7f0652b58147ff7812a20ee026327915">apply_momentum_cutoff</a>(0.1);</div>
<div class="line">    <span class="keywordtype">double</span> density_threshold = 0.01*(initial_norm_d[0]/(8*x_axis[nx-1]*y_axis[ny-1]*z_axis[nz-1]));</div>
<div class="line">    <a class="code hl_function" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a25c8821931fa4b1ea9f9c5858289c9bd">calculate_vortex_tangle_length</a>(density_threshold);</div>
<div class="line">    GraphicOutput::DataWriter quasi_condensate_out;</div>
<div class="line">    quasi_condensate_out.set_output_name(<span class="stringliteral">&quot;vortex_tangle&quot;</span>+std::to_string(iteration_number/write_output_every));</div>
<div class="line">    quasi_condensate_out.write_vtk(x_axis,y_axis,z_axis,vortex_tangle_density,<span class="stringliteral">&quot;psi&quot;</span>,<span class="stringliteral">&quot;BINARY&quot;</span>);</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclass_dipoles3d_html"><div class="ttname"><a href="class_dipoles3d.html">Dipoles3d</a></div><div class="ttdef"><b>Definition:</b> example-7.cpp:36</div></div>
<div class="ttc" id="aclass_dipoles3d_html_a040907cd0636d851dea43d1b3441aa96"><div class="ttname"><a href="class_dipoles3d.html#a040907cd0636d851dea43d1b3441aa96">Dipoles3d::write_operator_splitting_output</a></div><div class="ttdeci">void write_operator_splitting_output(size_t iteration_number, std::ostream &amp;output_stream) override</div><div class="ttdoc">Operator splitting output.</div><div class="ttdef"><b>Definition:</b> example-7.cpp:53</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver_html_a25c8821931fa4b1ea9f9c5858289c9bd"><div class="ttname"><a href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a25c8821931fa4b1ea9f9c5858289c9bd">UltraCold::cudaSolvers::DipolarGPSolver::calculate_vortex_tangle_length</a></div><div class="ttdeci">void calculate_vortex_tangle_length(double n_threshold)</div><div class="ttdoc">Apply a density threshold on a wave function.</div><div class="ttdef"><b>Definition:</b> cudaDipolarGPSolver.cu:1073</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver_html_a3829c8053041d1fb5e2aa9cc1d2da5a2"><div class="ttname"><a href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a3829c8053041d1fb5e2aa9cc1d2da5a2">UltraCold::cudaSolvers::DipolarGPSolver::evaluate_integrated_occupation_number</a></div><div class="ttdeci">void evaluate_integrated_occupation_number()</div><div class="ttdoc">Evaluate integrated momentum distributions for a three-dimensional problem.</div><div class="ttdef"><b>Definition:</b> cudaDipolarGPSolver.cu:938</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver_html_a7f0652b58147ff7812a20ee026327915"><div class="ttname"><a href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a7f0652b58147ff7812a20ee026327915">UltraCold::cudaSolvers::DipolarGPSolver::apply_momentum_cutoff</a></div><div class="ttdeci">void apply_momentum_cutoff(double kc)</div><div class="ttdoc">Apply a low-pass filter on the wave function.</div><div class="ttdef"><b>Definition:</b> cudaDipolarGPSolver.cu:1032</div></div>
<div class="ttc" id="aclassint_html"><div class="ttname"><a href="classint.html">int</a></div></div>
</div><!-- fragment --><p >The overridden function for the real time output contains calls to different functions for data analysis on the GPU. The first one is</p>
<div class="fragment"><div class="line">evaluate_integrated_occupation_number();</div>
</div><!-- fragment --><p >This function takes the current wave function stored in the GPU, calculates its Fourier transform, then calculates its modulus square (i.e., the momentum distribution) and finally integrates the momentum distribution along two axis. It also fills and returns to the host an <code>std::vector</code>, called <code>integrated_occupation_numbers</code>, containing three <code><a class="el" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a></code>, each of which contains the momentum distribution integrated along the two other directions. So, <code>integrated_occupation_number[0]</code> corresponds to \(\tilde{n}(k_x) = \int dk_ydk_z |\tilde{\psi}(k_x,k_y,k_z)|^2\), <code>integrated_occupation_number[1]</code> corresponds to \(\tilde{n}(k_y) = \int dk_xdk_z |\tilde{\psi}(k_x,k_y,k_z)|^2\), and <code>integrated_occupation_number[2]</code> corresponds to \(\tilde{n}(k_z) = \int dk_x dk_y |\tilde{\psi}(k_x,k_y,k_z)|^2\). The apparently complicated working of this function is an (I think) acceptable price to pay in order to minimize the operations performed on the host, maximizing instead those performed on the GPU.</p>
<p >After writing the integrated occupation numbers into files, we come to the next function for data analysis on the GPU, namely</p>
<div class="fragment"><div class="line">apply_momentum_cutoff(0.1);</div>
</div><!-- fragment --><p >This function takes the Fourier transform of the wave function previously calculated in <code>evaluate_integrated_occupation_number()</code> (this behavior should be changed, and the function <code>apply_momentum_cutoff()</code> should be made independent), cuts all momenta above the cutoff passed as an argument to the function (in this case, 0.1: the unit of length used in this program is the healing length, so a call to this function will cut all momenta above \( 0.1 \xi^{-1}\)), and then copies out a <code><a class="el" href="class_ultra_cold_1_1_vector.html">Vector&lt;std::complex&lt;double&gt;&gt;</a></code> called <code>wave_function_quasi_condensate</code> accessible from the host, for example for creating a graphic output.</p>
<p >Finally, the last interesting function is</p>
<div class="fragment"><div class="line">calculate_vortex_tangle_length(density_threshold);</div>
</div><!-- fragment --><p >Basically, what this function does is to find the position of the cores of the vortices in a vortex tangle by simply applying a threshold function on the quasi-condensate density (calculated with a call to <code>apply_momentum_cutoff(0.1)</code>), in this case choosing a threshold value of \(0.01 N/V\). This function also outputs the fraction of volume occupied by the vortex tangle (defined as the number of points of the mesh for which the quasi condensate density is smaller then the threshold value divided by the total number of points in the mesh) into a file called <em>vortex_tangle_length.txt</em>, and to pass to the host a <code><a class="el" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a></code> called <code>vortex_tangle_density</code> with a format particularly suited for fast and lightweight output (basically, it contains a 1 for each point of the mesh for which the density is smaller then a threshold, and 0 otherwise. It is particularly useful to visualize only the position of the vortices in the vortex tangle, and works very well together with Paraview).</p>
<p >The main function of the program does nothing special, it just, as usual, reads the input, set the mesh and box initial conditions, add Truncated Wigner noise, and then run in real time, just like in the example-6 in 2D.</p>
<h2><a class="anchor" id="Results-7"></a>
Results</h2>
<p >We just show an example of the vortex tangle evolution, starting from "box" initial conditions in Fourier space, and letting the vortex tangle evolve and decay.</p>
<div class="image">
<img src="example-7-tangle.png" alt="" width="800px"/>
</div>
<h2><a class="anchor" id="Uncommented-7"></a>
The plain program</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;UltraCold.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_ultra_cold.html">UltraCold</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Our solver class, with customizable real-time output</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="class_dipoles3d.html">Dipoles3d</a> : <span class="keyword">public</span> <a class="code hl_class" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html">cudaSolvers::DipolarGPSolver</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using </span>DipolarGPSolver::DipolarGPSolver;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="class_dipoles3d.html#a040907cd0636d851dea43d1b3441aa96">write_operator_splitting_output</a>(<span class="keywordtype">size_t</span> iteration_number,</div>
<div class="line">                                         std::ostream&amp; output_stream) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> set_healing_length(<span class="keywordtype">double</span> healing_length){ internal_healing_length = healing_length; };</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> kc;</div>
<div class="line">    <span class="keywordtype">double</span> internal_healing_length;</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="class_dipoles3d.html#a040907cd0636d851dea43d1b3441aa96">Dipoles3d::write_operator_splitting_output</a>(<span class="keywordtype">size_t</span> iteration_number,</div>
<div class="line">                                                std::ostream &amp;output_stream)</div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a3829c8053041d1fb5e2aa9cc1d2da5a2">evaluate_integrated_occupation_number</a>();</div>
<div class="line">    std::ofstream momentum_cuts;</div>
<div class="line">    momentum_cuts.open(<span class="stringliteral">&quot;nkx&quot;</span>+std::to_string(iteration_number/write_output_every)+<span class="stringliteral">&quot;.txt&quot;</span>,std::ios::out);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> ix = 0; ix &lt; <a class="code hl_class" href="classint.html">int</a>(nx/2); ++ix)</div>
<div class="line">        momentum_cuts &lt;&lt; kx_axis(ix) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                      &lt;&lt; integrated_occupation_number[0](ix)/(npoints)</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">    momentum_cuts.close();</div>
<div class="line"> </div>
<div class="line">    momentum_cuts.open(<span class="stringliteral">&quot;nky&quot;</span>+std::to_string(iteration_number/write_output_every)+<span class="stringliteral">&quot;.txt&quot;</span>,std::ios::out);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> iy = 0; iy &lt; <a class="code hl_class" href="classint.html">int</a>(ny/2); ++iy)</div>
<div class="line">        momentum_cuts &lt;&lt; ky_axis(iy) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                      &lt;&lt; integrated_occupation_number[1](iy)/npoints</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">    momentum_cuts.close();</div>
<div class="line"> </div>
<div class="line">    momentum_cuts.open(<span class="stringliteral">&quot;nkz&quot;</span>+std::to_string(iteration_number/write_output_every)+<span class="stringliteral">&quot;.txt&quot;</span>,std::ios::out);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> iz = 0; iz &lt; <a class="code hl_class" href="classint.html">int</a>(nz/2); ++iz)</div>
<div class="line">        momentum_cuts &lt;&lt; kz_axis(iz) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line">                      &lt;&lt; integrated_occupation_number[2](iz)/npoints</div>
<div class="line">                      &lt;&lt; std::endl;</div>
<div class="line">    momentum_cuts.close();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a7f0652b58147ff7812a20ee026327915">apply_momentum_cutoff</a>(0.1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> density_threshold = 0.01*(initial_norm_d[0]/(8*x_axis[nx-1]*y_axis[ny-1]*z_axis[nz-1]));</div>
<div class="line">    <a class="code hl_function" href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html#a25c8821931fa4b1ea9f9c5858289c9bd">calculate_vortex_tangle_length</a>(density_threshold);</div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_graphic_output_1_1_data_writer.html">GraphicOutput::DataWriter</a> quasi_condensate_out;</div>
<div class="line">    quasi_condensate_out.<a class="code hl_function" href="class_ultra_cold_1_1_graphic_output_1_1_data_writer.html#a5379ac7b98c084855b372e863c095856">set_output_name</a>(<span class="stringliteral">&quot;vortex_tangle&quot;</span>+std::to_string(iteration_number/write_output_every));</div>
<div class="line">    quasi_condensate_out.<a class="code hl_function" href="class_ultra_cold_1_1_graphic_output_1_1_data_writer.html#aec73552d1a4ccd5f3111c6268961279b">write_vtk</a>(x_axis,y_axis,z_axis,vortex_tangle_density,<span class="stringliteral">&quot;psi&quot;</span>,<span class="stringliteral">&quot;BINARY&quot;</span>);</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read input parameters from file &quot;dipolars3d.prm&quot;. This must be placed in the same directory as</span></div>
<div class="line">    <span class="comment">// the executable</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_tools_1_1_input_parser.html">Tools::InputParser</a> ip(<span class="stringliteral">&quot;example-7.prm&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    ip.read_input_file();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> xmax = ip.retrieve_double(<span class="stringliteral">&quot;xmax&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> ymax = ip.retrieve_double(<span class="stringliteral">&quot;ymax&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> zmax = ip.retrieve_double(<span class="stringliteral">&quot;zmax&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nx = ip.retrieve_int(<span class="stringliteral">&quot;nx&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> ny = ip.retrieve_int(<span class="stringliteral">&quot;ny&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> nz = ip.retrieve_int(<span class="stringliteral">&quot;ny&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> scattering_length = ip.retrieve_double(<span class="stringliteral">&quot;scattering length&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> dipolar_length    = ip.retrieve_double(<span class="stringliteral">&quot;dipolar length&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span>    number_of_particles = ip.retrieve_double(<span class="stringliteral">&quot;number of particles&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> atomic_mass         = ip.retrieve_double(<span class="stringliteral">&quot;atomic mass&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> theta = ip.retrieve_double(<span class="stringliteral">&quot;theta&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span>    number_of_gradient_descent_steps = ip.retrieve_int(<span class="stringliteral">&quot;number of gradient descent steps&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> alpha                            = ip.retrieve_double(<span class="stringliteral">&quot;alpha&quot;</span>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> beta                             = ip.retrieve_double(<span class="stringliteral">&quot;beta&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span>    number_of_real_time_steps = ip.retrieve_int(<span class="stringliteral">&quot;number of real time steps&quot;</span>);</div>
<div class="line">    <span class="keywordtype">double</span> time_step                       = ip.retrieve_double(<span class="stringliteral">&quot;time step&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> write_output_every=ip.retrieve_int(<span class="stringliteral">&quot;write output every&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> kcut = ip.retrieve_double(<span class="stringliteral">&quot;kcut&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// These two constants are for fixing the units</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> hbar        = 0.6347*1.E5; <span class="comment">// hbar in amu*mum^2/s</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> bohr_radius = 5.292E-5;    <span class="comment">// bohr radius in mum</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Some constants</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> density = number_of_particles/(8*xmax*ymax*zmax);</div>
<div class="line">    <span class="keywordtype">double</span> epsilon_dd = dipolar_length/scattering_length;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> chemical_potential = 4*PI*scattering_length*bohr_radius*density*(1-epsilon_dd);</div>
<div class="line">    <span class="keywordtype">double</span> healing_length = 1.0/std::sqrt(chemical_potential);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Atomic density = &quot;</span> &lt;&lt; density/100.0 &lt;&lt; <span class="stringliteral">&quot; 10^14 cm^{-3}&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Chemical potential = &quot;</span> &lt;&lt; chemical_potential &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Healing length = &quot;</span> &lt;&lt; healing_length &lt;&lt; <span class="stringliteral">&quot; mum&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;dx = &quot;</span> &lt;&lt; 2.*xmax/nx &lt;&lt; <span class="stringliteral">&quot; mum&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;kmax = &quot;</span> &lt;&lt; nx/(4*xmax) &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;dk = &quot;</span> &lt;&lt;  1./xmax &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;kxi dipo = &quot;</span> &lt;&lt; 1./healing_length &lt;&lt; std::endl;</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;kxi no dipo = &quot;</span> &lt;&lt; 1./sqrt(1.-epsilon_dd)*1./healing_length &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">    scattering_length *= bohr_radius/healing_length;</div>
<div class="line">    dipolar_length    *= bohr_radius/healing_length;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create the mesh</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a> x(nx);</div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a> y(ny);</div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a> z(nz);</div>
<div class="line"> </div>
<div class="line">    xmax = xmax/healing_length;</div>
<div class="line">    ymax = ymax/healing_length;</div>
<div class="line">    zmax = zmax/healing_length;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> dx = 2.*xmax/nx;</div>
<div class="line">    <span class="keywordtype">double</span> dy = 2.*ymax/ny;</div>
<div class="line">    <span class="keywordtype">double</span> dz = 2.*zmax/nz;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nx; ++i) x(i) = -xmax + i*dx;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; ny; ++i) y(i) = -ymax + i*dy;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nz; ++i) z(i) = -zmax + i*dz;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> dv = dx*dy*dz;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create the momentum mesh</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a> kx(nx),ky(ny),kz(nz);</div>
<div class="line">    create_mesh_in_Fourier_space(x,y,z,kx,ky,kz);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize wave function and external potential</span></div>
<div class="line">    <span class="comment">// Wave function is initialized in momentum space populating</span></div>
<div class="line">    <span class="comment">// low momentum modes each with a random phase</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_vector.html">Vector&lt;std::complex&lt;double&gt;</a>&gt; psi(nx,ny,nz),psitilde(nx,ny,nz);</div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_vector.html">Vector&lt;double&gt;</a> Vext(nx,ny,nz);</div>
<div class="line"> </div>
<div class="line">    std::default_random_engine generator;</div>
<div class="line"> </div>
<div class="line">    std::complex&lt;double&gt; ci={0.0,1.0};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">typedef</span> std::chrono::high_resolution_clock clock;</div>
<div class="line">    clock::time_point beginning = clock::now();</div>
<div class="line">    clock::duration d = clock::now() - beginning;</div>
<div class="line">    generator.seed(d.count());</div>
<div class="line">    std::uniform_real_distribution&lt;double&gt; phase_distribution(0,TWOPI);</div>
<div class="line">    std::uniform_real_distribution&lt;double&gt; density_distribution(0,1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nx; ++i)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; ny; ++j)</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; nz; ++k)</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordtype">double</span> random_phase = phase_distribution(generator);</div>
<div class="line">                <span class="keywordflow">if</span> (std::abs(kx(i)) &lt;= kcut/TWOPI &amp;&amp;</div>
<div class="line">                    std::abs(ky(j)) &lt;= kcut/TWOPI &amp;&amp;</div>
<div class="line">                    std::abs(kz(k)) &lt;= kcut/TWOPI )</div>
<div class="line">                    psitilde(i,j,k) = sqrt(density)*exp(-ci * random_phase);</div>
<div class="line">            }</div>
<div class="line">    <a class="code hl_class" href="class_ultra_cold_1_1_m_k_l_wrappers_1_1_d_ft_calculator.html">MKLWrappers::DFtCalculator</a> dft(psi,psitilde);</div>
<div class="line">    dft.compute_backward();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> norm = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; psi.size(); ++i) norm += std::norm(psi[i]);</div>
<div class="line">    norm *= dv;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; psi.size(); ++i) psi[i] *= std::sqrt(number_of_particles/norm);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the solver</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">    <a class="code hl_class" href="class_dipoles3d.html">Dipoles3d</a> gp_solver(x,y,z,psi,Vext,scattering_length,dipolar_length,theta,0,<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">    gp_solver.set_healing_length(healing_length);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the real time simulation!</span></div>
<div class="line">    <span class="comment">// The output will be written to the shell</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">    gp_solver.set_tw_initial_conditions(<span class="keyword">false</span>);</div>
<div class="line">    gp_solver.run_operator_splitting(number_of_real_time_steps,time_step,std::cout,write_output_every);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="ttc" id="aclass_ultra_cold_1_1_graphic_output_1_1_data_writer_html"><div class="ttname"><a href="class_ultra_cold_1_1_graphic_output_1_1_data_writer.html">UltraCold::GraphicOutput::DataWriter</a></div><div class="ttdoc">A class to output a data Vector in real space.</div><div class="ttdef"><b>Definition:</b> DataWriter.hpp:71</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1_graphic_output_1_1_data_writer_html_a5379ac7b98c084855b372e863c095856"><div class="ttname"><a href="class_ultra_cold_1_1_graphic_output_1_1_data_writer.html#a5379ac7b98c084855b372e863c095856">UltraCold::GraphicOutput::DataWriter::set_output_name</a></div><div class="ttdeci">void set_output_name(const std::string &amp;output_file_name)</div><div class="ttdoc">Set the name for the output data file, input as an std::string.</div><div class="ttdef"><b>Definition:</b> DataWriter.cpp:31</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1_graphic_output_1_1_data_writer_html_aec73552d1a4ccd5f3111c6268961279b"><div class="ttname"><a href="class_ultra_cold_1_1_graphic_output_1_1_data_writer.html#aec73552d1a4ccd5f3111c6268961279b">UltraCold::GraphicOutput::DataWriter::write_vtk</a></div><div class="ttdeci">void write_vtk(Vector&lt; double &gt; &amp;x_axis, Vector&lt; double &gt; &amp;y_axis, Vector&lt; double &gt; &amp;real_output_vector, const char *vector_name, const char *format)</div><div class="ttdoc">Write an output data file in .vtk format, for real 2D output.</div><div class="ttdef"><b>Definition:</b> DataWriter.cpp:805</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1_m_k_l_wrappers_1_1_d_ft_calculator_html"><div class="ttname"><a href="class_ultra_cold_1_1_m_k_l_wrappers_1_1_d_ft_calculator.html">UltraCold::MKLWrappers::DFtCalculator</a></div><div class="ttdoc">Class to calculate Fourier transforms using Intel's MKL DFT functions.</div><div class="ttdef"><b>Definition:</b> DFtCalculator.hpp:60</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1_tools_1_1_input_parser_html"><div class="ttname"><a href="class_ultra_cold_1_1_tools_1_1_input_parser.html">UltraCold::Tools::InputParser</a></div><div class="ttdoc">Class to read input parameters from files.</div><div class="ttdef"><b>Definition:</b> InputParser.hpp:93</div></div>
<div class="ttc" id="aclass_ultra_cold_1_1_vector_html"><div class="ttname"><a href="class_ultra_cold_1_1_vector.html">UltraCold::Vector&lt; double &gt;</a></div></div>
<div class="ttc" id="aclass_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver_html"><div class="ttname"><a href="class_ultra_cold_1_1cuda_solvers_1_1_dipolar_g_p_solver.html">UltraCold::cudaSolvers::DipolarGPSolver</a></div><div class="ttdoc">GPU-accelerated solver for a dipolar Gross-Pitaevskii equation.</div><div class="ttdef"><b>Definition:</b> cudaDipolarGPSolver.cuh:43</div></div>
<div class="ttc" id="anamespace_ultra_cold_html"><div class="ttname"><a href="namespace_ultra_cold.html">UltraCold</a></div><div class="ttdoc">All the classes and functions necessary to work with UltraCold.</div><div class="ttdef"><b>Definition:</b> BogolyubovSolver.cpp:25</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
